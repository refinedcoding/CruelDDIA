## 节点宕机时数据写入 P177 - P181, 0920
- 三个副本，一个宕机，主机配置为啥要执行故障切换？
- 无主配置，无需切换
- 节点宕机无法写入，读取时数据过时
- 解决办法，并发读请求，版本号确定最新值
- 读修复，比较得到最新版本，然后写入过期节点
- 反熵，后台进程持续检查副本之间的差异，用Markle树

## 读写的法定人数
- n个副本，写入w个节点才成功，每次读r个节点
- w + r > n，w 为读写的法定人数
- 写入读多，w = n, r = 1
- w < n，某些节点宕机，整个系统仍可写
- r < n，某些节点宕机，整个系统仍可读
- 可接受 n - w 个节点宕机

## 仲裁一致性的局限性，P182 - P186, 0921
- 法定人数可以小于半数，只要读写节点有交集
- 较小的 w 和 r 可能会获取到过时数据
- 宽松的法定人数，读写节点可能没有交集
- 用合并并发写入解决，但是由于时钟偏差，最新的写入可能会丢失
- 读写同时发生，不确定读取可能返回过期值
- 写操作小于w个节点，无法回滚，客户端会读错误写入的值
- 新值节点宕机，其他新值节点数量小于w，打破法定人数限制
- 334页的线性化和法定人数，来解决时序边缘的问题
- 无法完全使用法定人数保证读写最新值，通过调整w和r来控制过期值出现的概率
- TODO：单调读和一致性前缀读取
- 第七章事务，第九章共识算法
